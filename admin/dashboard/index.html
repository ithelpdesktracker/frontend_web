<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MTSS -Statistics</title>

    <link rel="icon" href="/imgs/question.png">
    <link rel="stylesheet" href="/vendor/simple-line-icons/css/simple-line-icons.css">
    <link rel="stylesheet" href="/vendor/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/roxy.css">

    <link rel="stylesheet" type="text/css" href="/css/util.css">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">



</head>

<body class="sidebar-fixed header-fixed">
    <div class="page-wrapper">
        <nav class="navbar page-header">
            <a href="#" class="btn btn-link sidebar-mobile-toggle d-md-none mr-auto">
                <i class="fa fa-bars"></i>
            </a>

            <a href="#" class="btn btn-link sidebar-toggle d-md-down-none">
                <i class="fa fa-bars"></i>
            </a>


        </nav>
        <!-- Sidebar Settings -->
        <div class="main-container">
            <div class="sidebar">
                <nav class="sidebar-nav">
                    <ul class="nav">
                        <li class="nav-title">MTSS - Admin Navigation</li>

                        <li class="nav-item">
                            <a href="/admin/dashboard" class="nav-link active">
                                <i class="fas fa-tachometer-alt"></i>Dashboard
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/admin/newissue" class="nav-link">
                                <i class="fas fa-plus"></i> New Issue
                            </a>
                        </li>

                        <li class="nav-item ">
                            <a href="/admin/issues" class="nav-link">
                                <i class="fas fa-address-card"></i> Issues
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/admin/settings" class="nav-link">
                                <i class="fas fa-wrench"></i>Settings
                            </a>
                        </li>

                        <li class="nav-title">More</li>

                        <li class="nav-item ">
                            <a href="#" class="nav-link" id="logout">
                                <i class="fa fa-lock"></i> Logout
                            </a>
                        </li>


                    </ul>
                </nav>
            </div>

            <!-- Here goes the Settings/Create_User_Page-->

            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-3">
                                <div class="card p-4">
                                    <div class="card-body d-flex justify-content-between align-items-center">

                                        <div>
                                            <input class="h4 d-block font-weight-normal mb-2" name="tickets-pending" id="tickets-pending" placeholder="400" style="background-color:rgba(0,0,0,0) !important;border:none !important;box-shadow:none !important;"
                                                required onfocus="this.blur();" disabled>

                                            <span>Unresolved Issues</span>

                                        </div>


                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-130">
                                    <div class="card">
                                        <div class="card-header bg-light" id="Dash"></div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/popper.js/popper.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap2.min.js"></script>
    <script src="/node_modules/axios/dist/axios.js"></script>
    <script src="/js/carbon.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script>
        var url = 'http://ec2-52-91-175-30.compute-1.amazonaws.com/api/unresolved';
        axios.get(url)
        .then(function (response) {
            console.log(response);
            $("#tickets-pending").attr('placeholder', response[0].Total_Unresolved);
        })
        .catch(function (error) {
            
        });
    </script>
    <script>
        $(document).ready(function () {
            drawStackChart();
        });


        //Draw Stack Chart
        var marginStackChart = {
                top: 20,
                right: 20,
                bottom: 30,
                left: 40
            },
            widthStackChart = 500 - marginStackChart.left - marginStackChart.right,
            heightStackChart = 300 - marginStackChart.top - marginStackChart.bottom;

        var xStackChart = d3.scaleBand()
            .range([0, widthStackChart])
            .padding(0.1);
        var yStackChart = d3.scaleLinear()
            .range([heightStackChart, 0]);


        var colorStackChart = d3.scaleOrdinal(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c",
            "#ff8c00"
        ])


        var canvasStackChart = d3.select("#Dash").append("svg")
            .attr("width", widthStackChart + marginStackChart.left + marginStackChart.right)
            .attr("height", heightStackChart + marginStackChart.top + marginStackChart.bottom)
            .append("g")
            .attr("transform", "translate(" + marginStackChart.left + "," + marginStackChart.top + ")");

        function drawStackChart() {


            var data = [{
                "tech_ucid": "amm87",
                "status": "resolved",
                "Total": 1
            }, {
                "tech_ucid": "amm87",
                "status": "unresolved",
                "Total": 19
            }, {
                "tech_ucid": "jb2",
                "status": "open",
                "Total": 3
            }, {
                "tech_ucid": "jic6",
                "status": "open",
                "Total": 21
            }, {
                "tech_ucid": "jic6",
                "status": "resolved",
                "Total": 2
            }, {
                "tech_ucid": "jic6",
                "status": "unresolved",
                "Total": 1
            }, {
                "tech_ucid": "lf5",
                "status": "open",
                "Total": 1
            }, {
                "tech_ucid": "sg2",
                "status": "open",
                "Total": 3
            }, {
                "tech_ucid": "tm3",
                "status": "closed",
                "Total": 1
            }, {
                "tech_ucid": "tm3",
                "status": "open",
                "Total": 1
            }, {
                "tech_ucid": "vcc3",
                "status": "resolved",
                "Total": 22
            }, {
                "tech_ucid": "yr2",
                "status": "open",
                "Total": 1
            }];



            colorStackChart.domain(d3.keys(data[0]).filter(function (key) {
                return key !== "Year";
            }));

            data.forEach(function (d) {
                var y0 = 0;
                d.ages = colorStackChart.domain().map(function (name) {
                    return {
                        name: name,
                        y0: y0,
                        y1: y0 += +d[name]
                    };
                });
                d.total = d.ages[d.ages.length - 1].y1;
            });

            data.sort(function (a, b) {
                return b.total - a.total;
            });

            xStackChart.domain(data.map(function (d) {
                return d.Year;
            }));
            yStackChart.domain([0, d3.max(data, function (d) {
                return d.total;
            })]);

            canvasStackChart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + heightStackChart + ")")
                .call(d3.axisBottom(xStackChart));

            canvasStackChart.append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(yStackChart))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("No Of Buildings");

            var state = canvasStackChart.selectAll(".Year")
                .data(data)
                .enter().append("g")
                .attr("class", "g")
                .attr("transform", function (d) {
                    return "translate(" + xStackChart(d.Year) + ",0)";
                });

            state.selectAll("rect")
                .data(function (d) {
                    return d.ages;
                })
                .enter().append("rect")
                .attr("width", xStackChart.bandwidth())
                .attr("y", function (d) {
                    return yStackChart(d.y1);
                })
                .attr("height", function (d) {
                    return yStackChart(d.y0) - yStackChart(d.y1);
                })
                .style("fill", function (d) {
                    return colorStackChart(d.name);
                });

            var legend = canvasStackChart.selectAll(".legend")
                .data(colorStackChart.domain().slice().reverse())
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function (d, i) {
                    return "translate(0," + i * 20 + ")";
                });

            legend.append("rect")
                .attr("x", widthStackChart - 18)
                .attr("width", 18)
                .attr("height", 18)
                .style("fill", colorStackChart);

            legend.append("text")
                .attr("x", widthStackChart - 24)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "end")
                .text(function (d) {
                    return d;
                });


        }
    </script>
</body>

</html>